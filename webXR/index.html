<!doctype html>
<html lang="en">
	<head>
		<title>Multi-Agent-XR</title>
		<meta charset="utf-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, user-scalable=no"
		/>
		<style>
			body {
				margin: 0;
				font-family: Arial, sans-serif;
			}
			
			#command-panel {
				position: fixed;
				top: 60px;
				left: 20px;
				z-index: 1000;
				background: rgba(0, 0, 0, 0.85);
				padding: 20px;
				border-radius: 10px;
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
				min-width: 350px;
			}
			
			#command-panel h3 {
				margin: 0 0 15px 0;
				color: #9c27b0;
				font-size: 16px;
			}
			
			#command-input {
				width: 100%;
				padding: 10px;
				border: 2px solid #9c27b0;
				border-radius: 5px;
				background: rgba(255, 255, 255, 0.9);
				font-size: 14px;
				box-sizing: border-box;
			}
			
			#command-input:focus {
				outline: none;
				border-color: #7b1fa2;
				background: white;
			}
			
			.button-group {
				display: flex;
				gap: 10px;
				margin-top: 10px;
			}
			
			button {
				flex: 1;
				padding: 10px;
				border: none;
				border-radius: 5px;
				cursor: pointer;
				font-size: 14px;
				font-weight: bold;
				transition: all 0.2s;
			}
			
			#execute-btn {
				background: #9c27b0;
				color: white;
			}
			
			#execute-btn:hover {
				background: #7b1fa2;
			}
			
			#clear-btn {
				background: #666;
				color: white;
			}
			
			#clear-btn:hover {
				background: #555;
			}
			
			#status {
				margin-top: 12px;
				padding: 8px;
				border-radius: 5px;
				font-size: 12px;
				min-height: 20px;
			}
			
			#status.success {
				background: rgba(76, 175, 80, 0.2);
				color: #4caf50;
				border-left: 3px solid #4caf50;
			}
			
			#status.error {
				background: rgba(244, 67, 54, 0.2);
				color: #f44336;
				border-left: 3px solid #f44336;
			}
			
			#status.processing {
				background: rgba(255, 152, 0, 0.2);
				color: #ff9800;
				border-left: 3px solid #ff9800;
			}
			
			.examples {
				margin-top: 15px;
				padding-top: 15px;
				border-top: 1px solid rgba(255, 255, 255, 0.1);
			}
			
			.examples-title {
				color: #bbb;
				font-size: 11px;
				margin-bottom: 8px;
				text-transform: uppercase;
			}
			
			.example-cmd {
				display: inline-block;
				background: rgba(156, 39, 176, 0.2);
				color: #ce93d8;
				padding: 4px 8px;
				margin: 3px;
				border-radius: 3px;
				font-size: 11px;
				cursor: pointer;
				border: 1px solid rgba(156, 39, 176, 0.3);
			}
			
			.example-cmd:hover {
				background: rgba(156, 39, 176, 0.4);
				border-color: #9c27b0;
			}
		</style>
	</head>
	<body>
		<div
			style="
				position: fixed;
				top: 10px;
				width: 100vw;
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				color: purple;
				font-weight: bold;
				font-size: 18px;
			"
		>
			<div>MAS-XR</div>
		</div>

		<!-- Natural Language Command Panel -->
		<div id="command-panel">
			<h3>Natural Language Commands</h3>
			
			<input 
				type="text" 
				id="command-input" 
				placeholder="e.g., move the chair forward"
				autocomplete="off"
			/>
			
			<div class="button-group">
				<button id="execute-btn" onclick="executeCommand()">
					Execute
				</button>
				<button id="clear-btn" onclick="clearCommand()">
					Clear
				</button>
			</div>
			
			<div id="status"></div>
			
			<div class="examples">
				<div class="examples-title">Quick Examples:</div>
				<span class="example-cmd" onclick="fillExample('move the chair forward')">
					move chair forward
				</span>
				<span class="example-cmd" onclick="fillExample('rotate the table 90 degrees')">
					rotate table 90Â°
				</span>
				<span class="example-cmd" onclick="fillExample('move the chair to the right')">
					move chair right
				</span>
				<span class="example-cmd" onclick="fillExample('move the chair back')">
					move chair back
				</span>
			</div>
		</div>

		<script type="module" src="./index.js"></script>
		
		<script>
			// Natural Language Command Functions

			const API_BASE_URL = `${window.location.protocol}//${window.location.hostname}:8000`;
			console.log('ðŸ”§ API URL:', API_BASE_URL);

			async function executeCommand() {
				const input = document.getElementById('command-input');
				const statusDiv = document.getElementById('status');
				const command = input.value.trim();
				
				if (!command) {
					updateStatus('Please enter a command', 'error');
					return;
				}
				
				// Show processing state
				updateStatus(`â³ Processing: "${command}"...`, 'processing');
				
				try {
					const response = await fetch(`${API_BASE_URL}/scene/command`, {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json'
						},
						body: JSON.stringify({
							command: command,
							user_position: getUserPosition()
						})
					});
					
					const result = await response.json();
					
					if (response.ok && result.status === 'success') {
						updateStatus(`âœ… Success: ${command}`, 'success');
						input.value = '';  // Clear input on success
					} else {
						updateStatus(`âŒ Failed: ${result.message || 'Unknown error'}`, 'error');
					}
					
				} catch (error) {
					console.error('Command execution error:', error);
					updateStatus(`âŒ Error: ${error.message}`, 'error');
				}
			}
			
			function clearCommand() {
				document.getElementById('command-input').value = '';
				document.getElementById('status').className = '';
				document.getElementById('status').textContent = '';
			}
			
			function fillExample(command) {
				document.getElementById('command-input').value = command;
				document.getElementById('command-input').focus();
			}
			
			function updateStatus(message, type) {
				const statusDiv = document.getElementById('status');
				statusDiv.textContent = message;
				statusDiv.className = type;
			}
			
			function getUserPosition() {
				// Try to get VR camera position from Three.js scene
				// This will be populated by your index.js
				if (window.vrCamera) {
					const pos = window.vrCamera.position;
					return {
						x: pos.x,
						y: pos.y,
						z: pos.z
					};
				}
				
				// Default position if camera not available yet
				return {x: 0, y: 0, z: 0};
			}
			
			// Enter key support
			document.getElementById('command-input').addEventListener('keypress', (e) => {
				if (e.key === 'Enter') {
					executeCommand();
				}
			});
			
			// Log when page loads
			console.log('ðŸŽ¯ Natural Language Command Interface Ready');
		</script>
	</body>
</html>
